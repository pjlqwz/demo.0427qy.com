<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>用户分表后怎么通过uid获取用户信息的方法_响应式网络软件网站模板</title>
<meta name="description" content="在前段时间湖南红网有一个需求，大概就是调用用户被置顶的帖子数排名的top10，测试的基本效果就是首先查询到top10的uid集合（由于功能模块原来的的数据结构中仅在置顶表中查询得到">
<meta name="keywords" content="Discuz,用户,分表,后,怎么,通过,uid,获取,信息">
<link href="/29833/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="static/css/bootstrap.min.css" rel="stylesheet" media="screen" type="text/css">
<link href="static/css/font-awesome.min.css" rel="stylesheet" media="screen" type="text/css">
<link href="static/css/owl.carousel.min.css" rel="stylesheet" media="screen" type="text/css">
<link href="static/css/magnific-popup.css" rel="stylesheet" media="screen" type="text/css">
<link href="static/css/style.css" rel="stylesheet" media="screen" type="text/css">
<link href="static/css/responsive.css" rel="stylesheet" media="screen" type="text/css">
</head>
<body class="baise">
<header class="header">
  <div class="main-header">
    <div class="main-menu-wrap">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-xl-3 col-lg-3 col-md-4 col-6">
            <div class="logo"> <a href="index.html"> <img src="static/picture/1-23062611262U06.png" data-rjs="2" alt="响应式网络软件网站模板"> </a> </div>
          </div>
          <div class="col-xl-6 col-lg-6 col-md-4 col-6 menu-button">
            <div class="menu--inner-area clearfix">
              <div class="menu-wraper">
                <nav>
                  <div class="header-menu dosis">
                    <ul>
                      <li><a href="index.html">首页</a></li>
                      <li><a href="index.html#features">功能</a></li>
                      <li><a href="index.html#app">界面</a></li>
                      <li><a href="index.html#pricing">价格</a></li>
                                            <li><a href="xinwen.html">新闻</a>
                        <ul>
                                                    <li><a href='dongtai.html'>动态</a></li>
                                                    <li><a href='zixun.html'>资讯</a></li>
                                                  </ul>
                      </li>
                                          </ul>
                  </div>
                </nav>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<div class="page-title-wrap" data-bg-img="/29833/template/pc/skin/images/video-bg.jpg">
  <div class="container">
    <div class="row">
      <div class="col">
        <div class="page-title-content text-center">
          <ul class="mb-0 list-unstyle nav">
            <li> <a href='index.html' class=''>首页</a> &gt; <a href='xinwen.html' class=''>新闻</a> &gt; <a href='dongtai.html'>动态</a></li>
          </ul>
          <h1 class="h2">动态</h1>
        </div>
      </div>
    </div>
  </div>
</div>
<section class="pt-120 pb-150">
  <div class="container">
    <div class="row">
      <div class="col-lg-8">
        <div class="blog-details-inner">
          <div class="single-blog-inner">
            <div class="post-content">
              <div class="post-details">
                <div class="post-info d-flex"> <span>2023-06-26</span></div>
                <div class="post-title">
                  <h3>用户分表后怎么通过uid获取用户信息的方法</h3>
                </div>
                <div> <p>
	在前段时间湖南红网有一个需求，大概就是调用用户被置顶的帖子数排名的top10，测试的基本效果就是首先查询到top10的uid集合（由于功能模块原来的的数据结构中仅在置顶表中查询得到uid的信息），最终效果如下（由于测试网站只有少部分数据，因此下面只显示5个）：</p><p><br></p><p>
	得到uid之后还需要得到用户相关的几个数据，包括头像、个人主页的url以及用户名；头像在discuz中可以使用avatar方法获取，个人主页的url通过uid直接拼装即可。而用户名则需要另外获取，可能有人会说直接使用DB类的fetch_first方法查询common_member表即可查到用户对应的用户名。</p><p>
	但一开始就有个前提，那就是网站的用户分表了，比如一般分表后会产生两个用户表，分别是common_member和common_member_archive，所以光查询前者肯定是不行的。其实阅读discuz的本身的源代码就可以发现，在很多地方他的做法都是通过判断用户是否在common_member中，如果存在则直接调用该值，否则需查询common_member_archive。如下是discuz本身的某个模块的源代码：</p><p><br></p><p>
	这样显然是可行的，但是通过C类发现并没有通过uid来查username的，只有通过username来查uid的，以上就是这样的。如果要用这种思路则需要这么来写：</p><p><br></p><p>
	然而，实际上有更加简便的方式的</p><p>
	那就是通过uc来做处理，因为要的是用户名等uc中也保存了的信息，而且对于普通网站用户而言uc中保存的用户信息和dz中保存的用户信息是一致的。比如在discuz源代码中可以看到如下这样的方法：</p><p><br></p><p>
	只要熟悉discuz开发的朋友都知道，看命名就可以顾名思义的，该方法是用于调取uc中的用户信息的。我们可以在uc_client/client.php找到该方法：</p><p><br></p><p>
	然后可以在uc_client/control/user.php中找到该方法所调用的方法：</p><p><br></p><p>
	也就是我们只需要在一开始的时候第二个参数传入1即可，也就是在该方法中会调用get_user_by_uid()，其中的参数其实是uid。然后我们可以在uc_client/model/user.php找到该方法：</p><p><br></p><p>
	这样就已经调取uc中的用户信息，需要注意的是，在上一步的onget_user方法中返回的时候并没有返回用户的所有信息，也不是返回带有uid、username、email等这些键值的数组。所以如果返回的是$user,如果需要取username的值，不能够写成$user[&#39;username&#39;]的。</p><p>
	至此，采用调用uc用户的方式通过discuz的用户uid获取的了用户的用户名。</p> <br>
                  <div class="text-secondary lh-2">                     <p>上一篇：<a href="2.html">微信支付官方紧急推送关于修复XXE漏洞提示，附</a></p>
                                        <p>下一篇：<a href="4.html">krpano上传多张大图时切图过程无响应分析</a></p>
                     </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-4"> <aside>
  <div class="single-sidebar-widget mb-30">
    <div class="search-bar-widget">
      <div class="search-form parsley-validate">         <form method="get" action="/29833/index.php?m=home&c=Search&a=lists" onsubmit="return searchForm();">
          <input type="text" name="keywords" id="keywords" placeholder="Search here..." required>
          <input type="hidden" name="m" value="home"><input type="hidden" name="c" value="Search"><input type="hidden" name="a" value="lists"><input type="hidden" name="method" value="1">        </form>
         </div>
    </div>
  </div>
  <div class="single-sidebar-widget mb-30">
    <div class="sidebar-title">
      <h5>推荐新闻</h5>
    </div>
    <div class="sidebar-body latest-post">
      <ul>
                <li>
          <div class="latest-post-wrap media">
            <div class="latest-post-img"> <img src="static/picture/1-230626161HD55.png" alt="微信订阅号消息列表改版：变成信息流了！"> </div>
            <div class="latest-post-body media-body">
              <p><a href="12.html">微信订阅号消息列表改版：变成信息流了！</a></p>
            </div>
          </div>
        </li>
                <li>
          <div class="latest-post-wrap media">
            <div class="latest-post-img"> <img src="static/picture/1-230626161210147.jpg" alt="微信小程序将逐步取消通过wx.getUserInfo方式获取用"> </div>
            <div class="latest-post-body media-body">
              <p><a href="11.html">微信小程序将逐步取消通过wx.getUserInfo方式获取用</a></p>
            </div>
          </div>
        </li>
                <li>
          <div class="latest-post-wrap media">
            <div class="latest-post-img"> <img src="static/picture/1-230626161KN02.jpg" alt="从四大层面看水滴筹合并轻松筹的可能性"> </div>
            <div class="latest-post-body media-body">
              <p><a href="7.html">从四大层面看水滴筹合并轻松筹的可能性</a></p>
            </div>
          </div>
        </li>
                <li>
          <div class="latest-post-wrap media">
            <div class="latest-post-img"> <img src="static/picture/1-230626161JC56.jpg" alt="微信小程序内测广告组件与新增快速创建能力等"> </div>
            <div class="latest-post-body media-body">
              <p><a href="8.html">微信小程序内测广告组件与新增快速创建能力等</a></p>
            </div>
          </div>
        </li>
                <li>
          <div class="latest-post-wrap media">
            <div class="latest-post-img"> <img src="static/picture/1-230626161209117.jpg" alt="咳咳，百度悄悄上线了跟微信一样的小程序"> </div>
            <div class="latest-post-body media-body">
              <p><a href="9.html">咳咳，百度悄悄上线了跟微信一样的小程序</a></p>
            </div>
          </div>
        </li>
                <li>
          <div class="latest-post-wrap media">
            <div class="latest-post-img"> <img src="static/picture/1-230626160136301.jpg" alt="网站制作及设计开发加上传，域名申请这些大概"> </div>
            <div class="latest-post-body media-body">
              <p><a href="6.html">网站制作及设计开发加上传，域名申请这些大概</a></p>
            </div>
          </div>
        </li>
                <li>
          <div class="latest-post-wrap media">
            <div class="latest-post-img"> <img src="static/picture/1-230626160135D4.jpg" alt="krpano上传多张大图时切图过程无响应分析"> </div>
            <div class="latest-post-body media-body">
              <p><a href="4.html">krpano上传多张大图时切图过程无响应分析</a></p>
            </div>
          </div>
        </li>
                <li>
          <div class="latest-post-wrap media">
            <div class="latest-post-img"> <img src="static/picture/1-23062616013D19.jpg" alt="一个神奇的“bug”挽回了整台服务器的数据"> </div>
            <div class="latest-post-body media-body">
              <p><a href="1.html">一个神奇的“bug”挽回了整台服务器的数据</a></p>
            </div>
          </div>
        </li>
              </ul>
    </div>
  </div>
</aside>
 </div>
    </div>
  </div>
</section>
<footer class="footer">
  <div class="footerbg"> <img src="static/picture/footer-bg.png"> </div>
  <div class="footer-top pt-120 pb-110">
    <div class="container">
      <div class="row">
        <div class="col-lg-3 col-sm-6">
          <div class="footer-widget">
            <div class="footer-logo"> <a href="index.html"><img src="static/picture/1-23062611262U06.png" alt="响应式网络软件网站模板"></a> </div>
            <p> 某某网络科技有限公司，是一家专业服务于企业信息化建设的提供商，专注于网站建设开发。</p>
          </div>
        </div>
        <div class="col-lg-3 col-sm-6">
          <div class="footer-widget">
            <div class="widget-header">
              <h5>联系我们</h5>
            </div>
            <div class="widget-body">
              <ul class="address-list">
                <li> <span><i class="fa  fa-phone-square"></i></span>020-88888888 </li>
                <li> <span><i class="fa  fa-envelope"></i></span> youweb@qq.com </li>
                <li> <span><i class="fa  fa-map"></i></span>广东省广州市</li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-sm-6">
          <div class="footer-widget">
            <div class="widget-header">
              <h5>友情链接</h5>
            </div>
          </div>
          <div class="widget-body">
            <div class="extra-link">
              <div class="link-left">
                <ul>
                                    <li><a href="http://www.baidu.com" target="_blank">百度</a></li>
                                    <li><a href="http://www.qq.com" target="_blank">腾讯</a></li>
                                    <li><a href="http://www.sina.com.cn" target="_blank">新浪</a></li>
                                    <li><a href="http://www.taobao.com" target="_blank">淘宝</a></li>
                                    <li><a href="http://www.weibo.com" target="_blank">微博</a></li>
                                  </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-sm-6">
          <div class="footer-widget">
            <div class="widget-body">
              <div class="twetter-post-inner">
                <div class="footer-post-details"> <img src="static/picture/1-23062614363X42.jpg" width="175"> </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer-bottom">
    <div class="footer-text text-center">
      <p>Copyright © 2012-2023 某某网络有限公司 版权所有<a href="https://beian.miit.gov.cn/" rel="nofollow" target="_blank">粤ICP备xxxxxxxx号</a> <a href="29833/sitemap.xml" target="_blank">XML地图</a> </p>
    </div>
  </div>
</footer>
<div class="back-to-top"> <a href="javascript:;"><i class="fa fa-chevron-up"></i></a> </div>
<script language="javascript" type="text/javascript" src="static/js/jquery-3.3.1.min.js"></script>
<script language="javascript" type="text/javascript" src="static/js/bootstrap.bundle.min.js"></script>
<script language="javascript" type="text/javascript" src="static/js/jquery.waypoints.min.js"></script>
<script language="javascript" type="text/javascript" src="static/js/parsley.min.js"></script>
<script language="javascript" type="text/javascript" src="static/js/parallax.js"></script>
<script language="javascript" type="text/javascript" src="static/js/owl.carousel.min.js"></script>
<script language="javascript" type="text/javascript" src="static/js/menu.min.js"></script>
<script language="javascript" type="text/javascript" src="static/js/jquery.magnific-popup.min.js"></script>
<script language="javascript" type="text/javascript" src="static/js/jquery.counterup.min.js"></script>
<script language="javascript" type="text/javascript" src="static/js/scripts.js"></script>
 
<!-- 应用插件标签 start --> 
  
<!-- 应用插件标签 end -->
</body>
</html>